// 일본 시구정촌명 → 한글 음차 변환
// 히라가나 읽기를 기반으로 한글로 변환
// 벤치마킹/데이터 비교: https://geojson.io/

import { MUNICIPALITY_KANA } from './municipalityKana'

// 한국에서 통용되는 관용 표기 (음차보다 우선)
const MUNICIPALITY_NAMES_KO: Record<string, string> = {
  // 정령지정도시 및 주요 도시
  札幌市: '삿포로시',
  仙台市: '센다이시',
  さいたま市: '사이타마시',
  千葉市: '지바시',
  横浜市: '요코하마시',
  川崎市: '가와사키시',
  相模原市: '사가미하라시',
  新潟市: '니가타시',
  静岡市: '시즈오카시',
  浜松市: '하마마쓰시',
  名古屋市: '나고야시',
  京都市: '교토시',
  大阪市: '오사카시',
  堺市: '사카이시',
  神戸市: '고베시',
  岡山市: '오카야마시',
  広島市: '히로시마시',
  北九州市: '기타큐슈시',
  福岡市: '후쿠오카시',
  熊本市: '구마모토시',
  // 공통 구 이름 (여러 정령지정도시에서 사용)
  中央区: '주오구',
  北区: '기타구',
  南区: '미나미구',
  西区: '니시구',
  東区: '히가시구',
  中区: '나카구',
  港区: '미나토구',
  緑区: '미도리구',
  旭区: '아사히구',
  青葉区: '아오바구',
  泉区: '이즈미구',
  // 도쿄 23구
  千代田区: '지요다구',
  新宿区: '신주쿠구',
  文京区: '분쿄구',
  台東区: '다이토구',
  墨田区: '스미다구',
  江東区: '고토구',
  品川区: '시나가와구',
  目黒区: '메구로구',
  大田区: '오타구',
  世田谷区: '세타가야구',
  渋谷区: '시부야구',
  中野区: '나카노구',
  杉並区: '스기나미구',
  豊島区: '도시마구',
  荒川区: '아라카와구',
  板橋区: '이타바시구',
  練馬区: '네리마구',
  足立区: '아다치구',
  葛飾区: '가쓰시카구',
  江戸川区: '에도가와구',
  // 삿포로시 구
  白石区: '시로이시구',
  厚別区: '앗사베쓰구',
  豊平区: '도요히라구',
  清田区: '기요타구',
  手稲区: '데이네구',
  // 센다이시 구
  宮城野区: '미야기노구',
  若林区: '와카바야시구',
  太白区: '다이하쿠구',
  // 사이타마시 구
  大宮区: '오미야구',
  見沼区: '미누마구',
  桜区: '사쿠라구',
  浦和区: '우라와구',
  岩槻区: '이와쓰키구',
  // 지바시 구
  花見川区: '하나미가와구',
  稲毛区: '이나게구',
  若葉区: '와카바구',
  美浜区: '미하마구',
  // 요코하마시 구
  鶴見区: '쓰루미구',
  神奈川区: '가나가와구',
  保土ケ谷区: '호도가야구',
  磯子区: '이소고구',
  金沢区: '가나자와구',
  港北区: '고호쿠구',
  戸塚区: '도쓰카구',
  港南区: '고난구',
  瀬谷区: '세야구',
  栄区: '사카에구',
  都筑区: '쓰즈키구',
  // 가와사키시 구
  川崎区: '가와사키구',
  幸区: '사이와이구',
  中原区: '나카하라구',
  高津区: '다카쓰구',
  多摩区: '다마구',
  宮前区: '미야마에구',
  麻生区: '아사오구',
  // 니가타시 구
  江南区: '고난구',
  秋葉区: '아키하구',
  西蒲区: '니시칸구',
  // 시즈오카시 구
  葵区: '아오이구',
  駿河区: '스루가구',
  清水区: '시미즈구',
  // 하마마쓰시 구
  浜北区: '하마키타구',
  天竜区: '덴류구',
  // 나고야시 구
  千種区: '지쿠사구',
  中村区: '나카무라구',
  昭和区: '쇼와구',
  瑞穂区: '미즈호구',
  熱田区: '아쓰타구',
  中川区: '나카가와구',
  守山区: '모리야마구',
  名東区: '메이토구',
  天白区: '덴파쿠구',
  // 교토시 구
  上京区: '가미교구',
  左京区: '사쿄구',
  中京区: '나카교구',
  東山区: '히가시야마구',
  下京区: '시모교구',
  右京区: '우쿄구',
  伏見区: '후시미구',
  山科区: '야마시나구',
  西京区: '니시쿄구',
  // 오사카시 구
  都島区: '미야코지마구',
  福島区: '후쿠시마구',
  此花区: '고노하나구',
  大正区: '다이쇼구',
  天王寺区: '덴노지구',
  浪速区: '나니와구',
  西淀川区: '니시요도가와구',
  東淀川区: '히가시요도가와구',
  東成区: '히가시나리구',
  生野区: '이쿠노구',
  城東区: '조토구',
  阿倍野区: '아베노구',
  住吉区: '스미요시구',
  東住吉区: '히가시스미요시구',
  西成区: '니시나리구',
  淀川区: '요도가와구',
  住之江区: '스미노에구',
  平野区: '히라노구',
  // 사카이시 구
  堺区: '사카이구',
  美原区: '미하라구',
  // 고베시 구
  東灘区: '히가시나다구',
  灘区: '나다구',
  兵庫区: '효고구',
  長田区: '나가타구',
  須磨区: '스마구',
  垂水区: '다루미구',
  // 히로시마시 구
  安佐南区: '아사미나미구',
  安佐北区: '아사키타구',
  安芸区: '아키구',
  佐伯区: '사에키구',
  // 기타큐슈시 구
  門司区: '모지구',
  若松区: '와카마쓰구',
  戸畑区: '도바타구',
  小倉北区: '고쿠라키타구',
  小倉南区: '고쿠라미나미구',
  八幡東区: '야하타히가시구',
  八幡西区: '야하타니시구',
  // 후쿠오카시 구
  博多区: '하카타구',
  城南区: '조난구',
  早良区: '사와라구',
  // 주요 관광/경제 도시
  旭川市: '아사히카와시',
  函館市: '하코다테시',
  小樽市: '오타루시',
  青森市: '아오모리시',
  盛岡市: '모리오카시',
  秋田市: '아키타시',
  山形市: '야마가타시',
  福島市: '후쿠시마시',
  水戸市: '미토시',
  宇都宮市: '우쓰노미야시',
  前橋市: '마에바시시',
  高崎市: '다카사키시',
  川越市: '가와고에시',
  船橋市: '후나바시시',
  八王子市: '하치오지시',
  町田市: '마치다시',
  藤沢市: '후지사와시',
  鎌倉市: '가마쿠라시',
  横須賀市: '요코스카시',
  富山市: '도야마시',
  金沢市: '가나자와시',
  福井市: '후쿠이시',
  甲府市: '고후시',
  長野市: '나가노시',
  松本市: '마쓰모토시',
  岐阜市: '기후시',
  豊橋市: '도요하시시',
  豊田市: '도요타시',
  津市: '쓰시',
  四日市市: '욧카이치시',
  大津市: '오쓰시',
  奈良市: '나라시',
  和歌山市: '와카야마시',
  鳥取市: '돗토리시',
  松江市: '마쓰에시',
  出雲市: '이즈모시',
  倉敷市: '구라시키시',
  福山市: '후쿠야마시',
  呉市: '구레시',
  下関市: '시모노세키시',
  徳島市: '도쿠시마시',
  高松市: '다카마쓰시',
  松山市: '마쓰야마시',
  高知市: '고치시',
  佐賀市: '사가시',
  長崎市: '나가사키시',
  佐世保市: '사세보시',
  大分市: '오이타시',
  別府市: '벳푸시',
  宮崎市: '미야자키시',
  鹿児島市: '가고시마시',
  那覇市: '나하시',
  // 유명 관광지
  日光市: '닛코시',
  箱根町: '하코네정',
  軽井沢町: '가루이자와정',
  熱海市: '아타미시',
  高山市: '다카야마시',
  白川村: '시라카와촌',
  彦根市: '히코네시',
  石垣市: '이시가키시',
  宮古島市: '미야코지마시',
}

// 히라가나 → 한글 변환 매핑
const HIRAGANA_TO_KOREAN: Record<string, string> = {
  // 기본 모음
  あ: '아', い: '이', う: '우', え: '에', お: '오',
  // か행
  か: '카', き: '키', く: '쿠', け: '케', こ: '코',
  が: '가', ぎ: '기', ぐ: '구', げ: '게', ご: '고',
  // さ행
  さ: '사', し: '시', す: '스', せ: '세', そ: '소',
  ざ: '자', じ: '지', ず: '즈', ぜ: '제', ぞ: '조',
  // た행
  た: '타', ち: '치', つ: '츠', て: '테', と: '토',
  だ: '다', ぢ: '지', づ: '즈', で: '데', ど: '도',
  // な행
  な: '나', に: '니', ぬ: '누', ね: '네', の: '노',
  // は행
  は: '하', ひ: '히', ふ: '후', へ: '헤', ほ: '호',
  ば: '바', び: '비', ぶ: '부', べ: '베', ぼ: '보',
  ぱ: '파', ぴ: '피', ぷ: '푸', ぺ: '페', ぽ: '포',
  // ま행
  ま: '마', み: '미', む: '무', め: '메', も: '모',
  // や행
  や: '야', ゆ: '유', よ: '요',
  // ら행
  ら: '라', り: '리', る: '루', れ: '레', ろ: '로',
  // わ행
  わ: '와', を: '오', ん: 'ㄴ',
  // 소문자 (요음용)
  ゃ: '야', ゅ: '유', ょ: '요',
  ぁ: '아', ぃ: '이', ぅ: '우', ぇ: '에', ぉ: '오',
  っ: '',
}

// 가타카나 → 한글 변환 매핑
const KATAKANA_TO_KOREAN: Record<string, string> = {
  // 기본 모음
  ア: '아', イ: '이', ウ: '우', エ: '에', オ: '오',
  // カ행
  カ: '카', キ: '키', ク: '쿠', ケ: '케', コ: '코',
  ガ: '가', ギ: '기', グ: '구', ゲ: '게', ゴ: '고',
  // サ행
  サ: '사', シ: '시', ス: '스', セ: '세', ソ: '소',
  ザ: '자', ジ: '지', ズ: '즈', ゼ: '제', ゾ: '조',
  // タ행
  タ: '타', チ: '치', ツ: '츠', テ: '테', ト: '토',
  ダ: '다', ヂ: '지', ヅ: '즈', デ: '데', ド: '도',
  // ナ행
  ナ: '나', ニ: '니', ヌ: '누', ネ: '네', ノ: '노',
  // ハ행
  ハ: '하', ヒ: '히', フ: '후', ヘ: '헤', ホ: '호',
  バ: '바', ビ: '비', ブ: '부', ベ: '베', ボ: '보',
  パ: '파', ピ: '피', プ: '푸', ペ: '페', ポ: '포',
  // マ행
  マ: '마', ミ: '미', ム: '무', メ: '메', モ: '모',
  // ヤ행
  ヤ: '야', ユ: '유', ヨ: '요',
  // ラ행
  ラ: '라', リ: '리', ル: '루', レ: '레', ロ: '로',
  // ワ행
  ワ: '와', ヲ: '오', ン: 'ㄴ',
  // 소문자 (요음용)
  ャ: '야', ュ: '유', ョ: '요',
  ァ: '아', ィ: '이', ゥ: '우', ェ: '에', ォ: '오',
  ッ: '',
  // 장음
  ー: '',
}

// 요음 조합 (2문자 → 1음절)
const YOON_COMBINATIONS: Record<string, string> = {
  // 히라가나 요음
  きゃ: '캬', きゅ: '큐', きょ: '쿄',
  ぎゃ: '갸', ぎゅ: '규', ぎょ: '교',
  しゃ: '샤', しゅ: '슈', しょ: '쇼',
  じゃ: '자', じゅ: '주', じょ: '조',
  ちゃ: '차', ちゅ: '추', ちょ: '초',
  にゃ: '냐', にゅ: '뉴', にょ: '뇨',
  ひゃ: '햐', ひゅ: '휴', ひょ: '효',
  びゃ: '뱌', びゅ: '뷰', びょ: '뵤',
  ぴゃ: '퍄', ぴゅ: '퓨', ぴょ: '표',
  みゃ: '먀', みゅ: '뮤', みょ: '묘',
  りゃ: '랴', りゅ: '류', りょ: '료',
  // 가타카나 요음
  キャ: '캬', キュ: '큐', キョ: '쿄',
  ギャ: '갸', ギュ: '규', ギョ: '교',
  シャ: '샤', シュ: '슈', ショ: '쇼',
  ジャ: '자', ジュ: '주', ジョ: '조',
  チャ: '차', チュ: '추', チョ: '초',
  ニャ: '냐', ニュ: '뉴', ニョ: '뇨',
  ヒャ: '햐', ヒュ: '휴', ヒョ: '효',
  ビャ: '뱌', ビュ: '뷰', ビョ: '뵤',
  ピャ: '퍄', ピュ: '퓨', ピョ: '표',
  ミャ: '먀', ミュ: '뮤', ミョ: '묘',
  リャ: '랴', リュ: '류', リョ: '료',
}

// 촉음(っ/ッ) 다음 자음에 따른 받침 처리
const SOKUON_NEXT: Record<string, string> = {
  k: 'ㄱ', s: 'ㅅ', t: 'ㅅ', p: 'ㅂ',
  か: 'ㄱ', き: 'ㄱ', く: 'ㄱ', け: 'ㄱ', こ: 'ㄱ',
  さ: 'ㅅ', し: 'ㅅ', す: 'ㅅ', せ: 'ㅅ', そ: 'ㅅ',
  た: 'ㅅ', ち: 'ㅅ', つ: 'ㅅ', て: 'ㅅ', と: 'ㅅ',
  ぱ: 'ㅂ', ぴ: 'ㅂ', ぷ: 'ㅂ', ぺ: 'ㅂ', ぽ: 'ㅂ',
  カ: 'ㄱ', キ: 'ㄱ', ク: 'ㄱ', ケ: 'ㄱ', コ: 'ㄱ',
  サ: 'ㅅ', シ: 'ㅅ', ス: 'ㅅ', セ: 'ㅅ', ソ: 'ㅅ',
  タ: 'ㅅ', チ: 'ㅅ', ツ: 'ㅅ', テ: 'ㅅ', ト: 'ㅅ',
  パ: 'ㅂ', ピ: 'ㅂ', プ: 'ㅂ', ペ: 'ㅂ', ポ: 'ㅂ',
}

// 장음 패턴 (3문자 먼저, 그 다음 2문자) - 히라가나 기준
// 요음 + う 장음 (3문자)
const LONG_VOWEL_3CHAR: Record<string, string> = {
  きょう: 'きょ', ぎょう: 'ぎょ',
  しょう: 'しょ', じょう: 'じょ',
  ちょう: 'ちょ',
  にょう: 'にょ',
  ひょう: 'ひょ', びょう: 'びょ', ぴょう: 'ぴょ',
  みょう: 'みょ',
  りょう: 'りょ',
  きゅう: 'きゅ', ぎゅう: 'ぎゅ',
  しゅう: 'しゅ', じゅう: 'じゅ',
  ちゅう: 'ちゅ',
  にゅう: 'にゅ',
  ひゅう: 'ひゅ', びゅう: 'びゅ', ぴゅう: 'ぴゅ',
  みゅう: 'みゅ',
  りゅう: 'りゅ',
}

// 장음 패턴 (2문자)
const LONG_VOWEL_2CHAR: Record<string, string> = {
  // おう → 오 (ou → o)
  おう: 'お', こう: 'こ', そう: 'そ', とう: 'と', のう: 'の',
  ほう: 'ほ', もう: 'も', よう: 'よ', ろう: 'ろ', ごう: 'ご',
  ぞう: 'ぞ', どう: 'ど', ぼう: 'ぼ', ぽう: 'ぽ',
  // 기타 장음
  ゅう: 'ゅ', ょう: 'ょ',
  // おお → 오 (oo → o)
  おお: 'お',
  // ああ → 아
  ああ: 'あ',
  // いい → 이
  いい: 'い',
  // うう → 우
  うう: 'う',
  // ええ → 에
  ええ: 'え', えい: 'え',
}

/**
 * 히라가나/가타카나를 한글로 변환
 */
function convertKanaToKorean(kana: string): string {
  if (!kana) return ''

  // 1단계: 장음 패턴 전처리 (3문자 먼저, 그 다음 2문자)
  let processed = kana
  for (const [pattern, replacement] of Object.entries(LONG_VOWEL_3CHAR)) {
    processed = processed.replaceAll(pattern, replacement)
  }
  for (const [pattern, replacement] of Object.entries(LONG_VOWEL_2CHAR)) {
    processed = processed.replaceAll(pattern, replacement)
  }

  let result = ''
  let i = 0

  while (i < processed.length) {
    // 2문자 요음 조합 체크
    if (i < processed.length - 1) {
      const twoChar = processed.slice(i, i + 2)
      if (YOON_COMBINATIONS[twoChar]) {
        result += YOON_COMBINATIONS[twoChar]
        i += 2
        continue
      }
    }

    const char = processed[i]

    // 촉음 처리
    if (char === 'っ' || char === 'ッ') {
      const nextChar = processed[i + 1]
      if (nextChar && SOKUON_NEXT[nextChar]) {
        result += SOKUON_NEXT[nextChar]
      }
      i++
      continue
    }

    // 히라가나
    if (HIRAGANA_TO_KOREAN[char]) {
      result += HIRAGANA_TO_KOREAN[char]
    }
    // 가타카나
    else if (KATAKANA_TO_KOREAN[char]) {
      result += KATAKANA_TO_KOREAN[char]
    }
    // 그 외 (숫자, 영문, 기호 등)
    else {
      result += char
    }

    i++
  }

  // 후처리: 받침 ㄴ을 앞 글자에 합치기
  result = combineJongseong(result)

  return result
}

/**
 * 홀로 있는 ㄴ 받침을 앞 글자에 합치기
 */
function combineJongseong(text: string): string {
  let result = ''
  const chars = [...text]

  for (let i = 0; i < chars.length; i++) {
    const char = chars[i]

    // ㄴ이 홀로 있고 앞에 한글 완성형이 있으면 받침으로 합치기
    if ((char === 'ㄴ' || char === 'ㄱ' || char === 'ㅅ' || char === 'ㅂ') && i > 0) {
      const prevChar = result[result.length - 1]
      const prevCode = prevChar.charCodeAt(0)

      // 한글 완성형 범위: 0xAC00 ~ 0xD7A3
      if (prevCode >= 0xAC00 && prevCode <= 0xD7A3) {
        // 현재 글자가 받침이 없는지 확인
        const prevJongseong = (prevCode - 0xAC00) % 28

        if (prevJongseong === 0) {
          // 받침 없음 - 받침 추가
          let jongseongIndex = 0
          if (char === 'ㄴ') jongseongIndex = 4 // ㄴ
          else if (char === 'ㄱ') jongseongIndex = 1 // ㄱ
          else if (char === 'ㅅ') jongseongIndex = 19 // ㅅ
          else if (char === 'ㅂ') jongseongIndex = 17 // ㅂ

          const newCode = prevCode + jongseongIndex
          result = result.slice(0, -1) + String.fromCharCode(newCode)
          continue
        }
      }
    }

    result += char
  }

  return result
}

/**
 * 시구정촌명에 대한 한글 변환
 * 1. 관용표기가 있으면 사용 (삿포로, 도쿄 등)
 * 2. MUNICIPALITY_KANA에서 히라가나 읽기를 찾아 변환
 * 3. 히라가나/가타카나가 포함된 이름은 그대로 변환
 */
export function getMunicipalityNameKo(name: string): string {
  if (!name) return ''

  // 1. 관용표기 확인 (우선)
  if (MUNICIPALITY_NAMES_KO[name]) {
    return MUNICIPALITY_NAMES_KO[name]
  }

  // 2. 시구정촌 히라가나 읽기 찾기
  const kana = MUNICIPALITY_KANA[name]

  if (kana) {
    // 히라가나를 한글로 변환
    return convertKanaToKorean(kana)
  }

  // 3. 매핑이 없으면 히라가나/가타카나가 포함된 이름일 수 있음
  // 그대로 변환 시도
  return convertKanaToKorean(name)
}

/**
 * 일반 일본어 텍스트를 한글로 변환 (히라가나/가타카나만)
 */
export function convertJapaneseToKorean(text: string): string {
  return convertKanaToKorean(text)
}

// 한글 → 일본어 역변환 매핑 (관용표기)
const MUNICIPALITY_NAMES_JA: Record<string, string> = Object.fromEntries(
  Object.entries(MUNICIPALITY_NAMES_KO).map(([ja, ko]) => [ko, ja])
)

// 한글 → 일본어 역변환 매핑 (히라가나 기반 변환)
const MUNICIPALITY_KANA_REVERSE: Record<string, string> = {}

// MUNICIPALITY_KANA를 기반으로 역변환 매핑 생성
for (const [ja, kana] of Object.entries(MUNICIPALITY_KANA)) {
  const ko = convertKanaToKorean(kana)
  if (ko && !MUNICIPALITY_KANA_REVERSE[ko]) {
    MUNICIPALITY_KANA_REVERSE[ko] = ja
  }
}

/**
 * 시구정촌 한글명 → 일본어명 역변환
 */
export function getMunicipalityNameJa(koreanName: string): string {
  if (!koreanName) return ''

  // 1. 관용표기 역변환 확인
  if (MUNICIPALITY_NAMES_JA[koreanName]) {
    return MUNICIPALITY_NAMES_JA[koreanName]
  }

  // 2. 히라가나 기반 역변환 확인
  if (MUNICIPALITY_KANA_REVERSE[koreanName]) {
    return MUNICIPALITY_KANA_REVERSE[koreanName]
  }

  // 3. 매핑이 없으면 그대로 반환
  return koreanName
}
